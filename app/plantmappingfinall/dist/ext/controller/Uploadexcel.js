sap.ui.define(["sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/UIComponent"],function(e,r,t){"use strict";function n(t,n){var o;function a(e){o&&o.getBeginButton().setEnabled(e)}function l(e){o.setBusy(e)}function i(){o&&o.close()}function s(r,t,n){e.error("Upload failed",{title:"Error"})}function u(e){return sap.ui.core.Fragment.byId("excelUploadDialog",e)}return{onBeforeOpen:function(e){o=e.getSource();t.addDependent(o)},onAfterClose:function(e){t.removeDependent(o);o.destroy();o=undefined},onOk:function(e){debugger;l(true);var r=u("uploader");var t=new sap.ui.unified.FileUploaderParameter;t.setName("slug");t.setValue(n);r.removeHeaderParameter("slug");r.addHeaderParameter(t);debugger;var o=e.getSource().getParent().getParent().getParent().getModel().aBindings[0].oModel.sServiceUrl;var a=o+"ExcelUpload/excel";r.setUploadUrl(a);r.checkFileReadable().then(function(){r.upload()}).catch(function(e){s("The file cannot be read.");l(false)})},onCancel:function(e){i()},onTypeMismatch:function(e){var r=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");s("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+r)},onFileAllowed:function(e){a(true)},onFileEmpty:function(e){a(false)},onUploadComplete:function(e){var n=e.getParameter("status");var o=e.getSource();o.clear();a(false);l(false);if(n>=400){var u;try{u=JSON.parse(e.getParameter("responseRaw"))}catch(r){u=e.getParameter("responseRaw")}if(u&&u.error&&u.error.message){s(u.error.code,u.error.target,u&&u.error&&u.error.message)}}else{r.show("File uploaded successfully");t.refresh();i()}}}}return{upload:function(e,r){debugger;this.loadFragment({id:"excelUploadDialog",name:"plantmappingfinall.ext.fragment.uploadfrag",controller:n(this,"plant")}).then(function(e){e.open()})}}});